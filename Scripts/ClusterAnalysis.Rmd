---
title: "Clustering Analysis"
output: html_notebook
---

Set up working space

This data was only given information for host, sox and mox channels in supervised method.
```{r}
rm(list=ls())
library(Cardinal)
load('../Results/ssc-adaptive-unsupervised-clustering-analysis.RData') ##ssc clustering 
load('../Results/HostSoxMox/supervised-clustering-anlaysis.RData') ## supervised classifaction with ssc
load('../Results/HostSoxMox/unsupervised-clustering-analysis.RData') ## unsupervised clustering
ls()
```



## Unsupervised Clustering Analysis with Cardinal 

This is k-means spatial clustering, we told the program to find clusters at k=3,5, & 7 with smoothing radius at 1 & 2. This is for a visual representation of the data. Please see the SCC for statistical support of the cluster groups

```{r}
print('adaptive')
summary(skma)
image(skma, key = T, layout = c(3, 2))
```


```{r}
print('gaussian')
summary(skmg)
image(skmg, key = T, layout = c(3, 2))
```

Both the gaussian and adaptive methods give similar results. The heterogenius tissue likely requires a smoothing radius of 1 because of the patchyness. Suggest using only the adaptive weights moving forward in the analysis. 


#### Spatial shrunken centrioids clustering to provide segmentation graphics

From the cardinal workflows document: 

*"The spatial shrunken centroids clustering method for statistical analysis we introduce in Cardinal in the spatialShrunkenCentroids method.* 

*The Gaussian and adaptive weights are retained from the spatially-aware k-means clustering [3]. In addition, we introduce statistical regularization as in nearest shrunken centroids to enforce feature sparsity [4]. This means doing feature selection, so that the analysis automatically identifies informative m/z values."*

```{r}
print('Adaptive')
summary(ssc.a)
```

Plot the spatial segments 

```{r}
plot(summary(ssc.a))
```


```{r}
image(ssc.a, model=list(r=1, s=15))
```


```{r, message=FALSE, warning=FALSE, include=FALSE}
summaryPlots <- function(dataset, results, model, segment, name, col) {
image(results, model = model, key = FALSE, column = segment, main = name,
layout = c(3, 2), col = col)
plot(results, model = model, key = FALSE, column = segment, mode = "centers",
main = "Shrunken mean spectrum", col = col)
plot(results, model = model, key = FALSE, column = segment, mode = "tstatistics",
main = "Shrunken t-statistics", col = col)
top <- topLabels(results, n = 3, model = model, filter = list(classes = segment))
image(dataset, mz = top$mz, normalize.image = "linear", contrast.enhance = "histogram",
smooth.image = "gaussian")
 }
```


Summerize important segments through plots

```{r}
load('../Data/Cardinal_Processed_Data.RData')
mycol<-c(Tissue='Purple', Red='Red',Green='Green', summaryPlots(maldifishmz,ssc.a,model=list(r=1, s=15, k=15),segment=4, name='', col=mycol)
Mixed='Purple')
```


```{r}
summaryPlots(maldifishmz,ssc.a,model=list(r=1, s=15, k=15),segment=1, name='Bacteria Rich Tissue', col=mycol)
summaryPlots(maldifishmz,ssc.a,model=list(r=1, s=15, k=15),segment=2, name='Cilated Edge', col=mycol)
summaryPlots(maldifishmz,ssc.a,model=list(r=1, s=15, k=15),segment=3, name='noise?', col=mycol)
summaryPlots(maldifishmz,ssc.a,model=list(r=1, s=15, k=15),segment=4, name='Bacterial rich region', col=mycol)
```











## Supervised Clustering Analysis with Cardinal 

The analysis below is a supervised clustering analysis, where we told Cardinal that we expect to have 3 groups (host, mox, sox) and to find signals that are related to these groups using a cross valudation method. The data was randomly split into 50 CV groups and the analysis was preformed by leaving out the signals from one group at a time. This was done for both the adaptive method and the gaussian method. 


```{r}
print('Adaptive')
plot(summary(ssca.cv))
```






